<!DOCTYPE html><html><head>
      <title>mmwave level sensing demo notes</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Admin\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.6.8\node_modules\@shd101wyy\mume\dependencies\katex\katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p,html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div{display:inline}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  300px/2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="abstract">Abstract</h1>

<p>TI has developed the IWR1843 mmWave radar sensor for industrial and automotive applications, including level sensing. A guide with notes on how to design and implement level sensing systems using the IWR1843 is available, covering topics such as signal processing, antenna design, and calibration techniques. This guide helps users understand and optimize the IWR1843&apos;s level sensing capabilities.</p>
<h1 class="mume-header" id="referance">Referance</h1>

<p><a href="high_accuracy_user_guide.html">high_accuracy_user_guide.html</a><br>
<a href="https://dev.ti.com/tirex/explore/node?a=VLyFKFf__2.4.0&amp;node=A__AMIRzzFfLQdhCxzdyy.fEg__radar_toolbox__1AslXXD__LATEST">resource explorer</a></p>
<h1 class="mume-header" id="%E5%8E%9F%E7%90%86">&#x539F;&#x7406;</h1>

<p>&#x8FD9;&#x4E2A;&#x5B9E;&#x9A8C;&#x914D;&#x7F6E;&#x4E86;&#x4E00;&#x4E2A;&#x53D1;&#x5C04;&#x5929;&#x7EBF;&#x548C;&#x4E00;&#x4E2A;&#x63A5;&#x6536;&#x5929;&#x7EBF;&#xFF0C;&#x5E76;&#x5229;&#x7528;Zoom FFT&#x6280;&#x672F;&#x8FDB;&#x884C;&#x64CD;&#x4F5C;&#xFF0C;&#x8FD9;&#x79CD;&#x6280;&#x672F;&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x6B65;&#x9AA4;&#x3002;&#x7B2C;&#x4E00;&#x6B65;&#x662F;&#x8FDB;&#x884C;&#x4E00;&#x7EF4;&#x7C97;&#x7565;FFT&#x4EE5;&#x641C;&#x7D22;&#x5CF0;&#x503C;&#x3002;&#x7B2C;&#x4E8C;&#x6B65;&#x662F;&#x8FDB;&#x884C;&#x7B2C;&#x4E8C;&#x4E2A;&#x653E;&#x5927;FFT&#xFF0C;&#x5B83;&#x4EE5;&#x66F4;&#x9AD8;&#x7684;&#x5206;&#x8FA8;&#x7387;&#x5206;&#x6790;&#x5CF0;&#x503C;&#x9891;&#x8C31;&#x7684;&#x4E00;&#x90E8;&#x5206;</p>
<h1 class="mume-header" id="%E5%AF%B9%E6%AF%9414xx-%E5%92%8C--16xx68xx">&#x5BF9;&#x6BD4;<code>14xx</code> &#x548C;  <code>16xx/68xx</code></h1>

<p>&#x7531;&#x4E8E;16xx/68xx&#x8BBE;&#x5907;&#x5305;&#x62EC;&#x7247;&#x4E0A;DSP&#xFF0C;&#x800C;14xx&#x8BBE;&#x5907;&#x6CA1;&#x6709;&#xFF0C;&#x56E0;&#x6B64;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4E00;&#x4E9B;&#x5DEE;&#x5F02;&#x3002;&#x7531;&#x4E8E;&#x7247;&#x4E0A;FFT&#x52A0;&#x901F;&#x5668;&#x7684;&#x786C;&#x4EF6;&#x9650;&#x5236;&#xFF0C;14xx&#x7248;&#x672C;&#x7684;&#x6700;&#x5927;FFT&#x5927;&#x5C0F;&#x4E3A;16K&#x3002;&#x56E0;&#x6B64;&#xFF0C;14xx&#x7248;&#x672C;&#x5C06;&#x5177;&#x6709;&#x66F4;&#x4F4E;&#x7684;&#x5904;&#x7406;&#x5EF6;&#x8FDF;&#x4EE5;&#x53CA;&#x66F4;&#x4F4E;&#x7684;&#x529F;&#x8017;&#x3002;16xx/68xx&#x7248;&#x672C;&#x4F7F;&#x7528;&#x7247;&#x4E0A;DSP&#xFF0C;&#x56E0;&#x6B64;&#x5206;&#x8FA8;&#x7387;&#x66F4;&#x9AD8;&#xFF0C;FFT&#x5927;&#x5C0F;&#x4E5F;&#x66F4;&#x5927;.</p>
<h1 class="mume-header" id="%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%E8%A7%A3%E6%9E%90">&#x914D;&#x7F6E;&#x547D;&#x4EE4;&#x89E3;&#x6790;</h1>

<p>&#x547D;&#x4EE4; RangeLimitCfg &#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x53C2;&#x6570;&#x7ED3;&#x6784; &#xFF0C;&#x5176;&#x4E2D;&#xFF1A;</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash">RangeLimitCfg <span class="token operator">&lt;</span>numRangeBinZoomIn<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>dis/enable<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>min range limited<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>max range limited<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>numRangeBinZoomIn <span class="token operator">&gt;</span>&#xFF08;&#x4EC5;&#x9650; 16xx/68xx&#xFF09;&#xFF1A;&#x662F;&#x5728;&#x7C97;&#x5CF0;&#x4E24;&#x4FA7;&#x653E;&#x5927;&#x7684;&#x7BB1;&#x6570;&#x3002;&#x6CE8;&#x610F;&#xFF1A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x4F18;&#x5316;&#x503C;&#xFF0C;&#x4E0D;&#x5EFA;&#x8BAE;&#x8FDB;&#x884C;&#x66F4;&#x6539;&#x3002;
<span class="token operator">&lt;</span>dis/enable<span class="token operator">&gt;</span>&#xFF1A;0 &#x8868;&#x793A;&#x7981;&#x7528;&#xFF0C;1 &#x8868;&#x793A;&#x5DF2;&#x542F;&#x7528;
<span class="token operator">&lt;</span>min range limited<span class="token operator">&gt;</span>&#xFF1A;&#x4EE5;&#x7C73;&#x4E3A;&#x5355;&#x4F4D;
<span class="token operator">&lt;</span>max range limited<span class="token operator">&gt;</span>&#xFF1A;&#x4EE5;&#x7C73;&#x4E3A;&#x5355;&#x4F4D;
</pre><p>E: RangeLimitCfg 2 1 1.0 3.0</p>
<h1 class="mume-header" id="1-mss%E9%80%9A%E8%BF%87uart%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90">1. MSS&#x901A;&#x8FC7;UART&#x53D1;&#x9001;&#x6570;&#x636E;&#x4EE3;&#x7801;&#x89E3;&#x6790;</h1>

<p>&#x8FD9;&#x91CC;&#x6574;&#x4F53;&#x7684;&#x53D1;&#x9001;&#x903B;&#x8F91;&#x662F;<code>dss</code>&#x901A;&#x8FC7;<code>mailBox</code>&#x53D1;&#x9001;&#x4E00;&#x4E2A;<code>Semaphore</code>&#x7ED9;<code>mss</code>, &#x7136;&#x540E;<code>mss</code>&#x67E5;&#x770B;<code>Semaphore</code>&#x7684;&#x7C7B;&#x578B;,<br>
&#x5982;&#x679C;&#x662F;<code>MMWDEMO_DSS2MSS_DETOBJ_READY</code>&#x5C31;&#x53BB;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E2D;&#x5C06;<code>dss</code>&#x5904;&#x7406;&#x597D;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x51FA;&#x6765;, &#x62F7;&#x8D1D;&#x5230;<code>mss</code>&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E2D;,<br>
&#x7136;&#x540E;<code>mss</code>&#x5C31;&#x5BF9;<code>mss</code>&#x8FD9;&#x8FB9;&#x7684;&#x8FD9;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x505A;&#x64CD;&#x4F5C;.</p>
<h2 class="mume-header" id="12-mailbox%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE%E7%9A%84%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B">1.2 MailBox&#x53D1;&#x9001;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;&#x6D41;&#x7A0B;</h2>

<p>src: <code>mss_main.c</code></p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token comment">/*z:&#x8FD9;&#x4E2A;&#x662F;mailbox&#x7684;&#x51FD;&#x6570;, dsp&#x548C;mss&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#x7684;&#x5DE5;&#x5177; */</span>
<span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">MmwDemo_mboxReadTask</span><span class="token punctuation">(</span>UArg arg0<span class="token punctuation">,</span> UArg arg1<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    MmwDemo_message      message<span class="token punctuation">;</span>
    <span class="token class-name">int32_t</span>              retVal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span>             timeStart<span class="token punctuation">;</span>

    <span class="token comment">/* wait for new message and process all the messages received from the peer */</span>
    <span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/* &#x4E00;&#x76F4;&#x7B49;&#x5F85;mailbox&#x53D1;&#x9001;&#x53D1;&#x8FC7;&#x6765;&#x6570;&#x636E;, &#x5982;&#x679C;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5C31;&#x4E00;&#x76F4;&#x6302;&#x8D77;. */</span>
        <span class="token function">Semaphore_pend</span><span class="token punctuation">(</span>gMmwMssMCB<span class="token punctuation">.</span>mboxSemHandle<span class="token punctuation">,</span> BIOS_WAIT_FOREVER<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* Read the message from the peer mailbox: We are not trying to protect the read
         * from the peer mailbox because this is only being invoked from a single thread */</span>
       
        <span class="token comment">/* &#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x6D88;&#x606F;&#x90AE;&#x7BB1; (Mailbox) &#x4E2D;&#x8BFB;&#x53D6;&#x6D88;&#x606F;&#xFF0C;&#x5E76;&#x5C06;&#x6D88;&#x606F;&#x5185;&#x5BB9;&#x4FDD;&#x5B58;&#x5230;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; message 
         * &#x7684;&#x53D8;&#x91CF;&#x4E2D;&#x3002;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x4E86; Mailbox_read() &#x51FD;&#x6570;&#x6765;&#x4ECE;&#x540D;&#x4E3A; gMmwMssMCB &#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x6240;
         * &#x8868;&#x793A;&#x7684;&#x90AE;&#x7BB1;&#x4E2D;&#x8BFB;&#x53D6;&#x6D88;&#x606F;&#x3002;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5F85;&#x8BFB;&#x53D6;&#x7684;&#x90AE;&#x7BB1;&#xFF0C;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x5B58;&#x50A8;&#x6D88;&#x606F;&#x7684;&#x7F13;&#x51B2;&#x533A;
         * &#x7684;&#x6307;&#x9488;&#xFF0C;&#x7B2C;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x8981;&#x8BFB;&#x53D6;&#x7684;&#x6D88;&#x606F;&#x7684;&#x957F;&#x5EA6;&#x3002;&#x8BE5;&#x51FD;&#x6570;&#x5C06;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x8868;&#x793A;&#x64CD;&#x4F5C;&#x7ED3;&#x679C;&#x7684;&#x503C;&#x3002;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;
         * &#x53D8;&#x91CF; retVal &#x5C06;&#x88AB;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x3002;

         * &#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x4EFB;&#x4F55;&#x591A;&#x7EBF;&#x7A0B;&#x4FDD;&#x62A4;&#x63AA;&#x65BD;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x4EE3;&#x7801;&#x88AB;&#x5047;&#x5B9A;&#x53EA;&#x4F1A;&#x4ECE;&#x4E00;&#x4E2A;
         * &#x5355;&#x4E00;&#x7684;&#x7EBF;&#x7A0B;&#x4E2D;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x5982;&#x679C;&#x6709;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EF;&#x80FD;&#x4F1A;&#x540C;&#x65F6;&#x8BBF;&#x95EE;&#x540C;&#x4E00;&#x4E2A;&#x90AE;&#x7BB1;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x9700;&#x8981;&#x5728;&#x8BBF;&#x95EE;&#x90AE;&#x7BB1;&#x7684;&#x8FC7;&#x7A0B;
         * &#x4E2D;&#x91C7;&#x53D6;&#x9002;&#x5F53;&#x7684;&#x540C;&#x6B65;&#x63AA;&#x65BD;&#x6765;&#x786E;&#x4FDD;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x6027; */</span>
        retVal <span class="token operator">=</span> <span class="token function">Mailbox_read</span><span class="token punctuation">(</span>gMmwMssMCB<span class="token punctuation">.</span>peerMailbox<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>message<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>retVal <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">/* Error: Unable to read the message. Setup the error code and return values */</span>
            <span class="token function">System_printf</span> <span class="token punctuation">(</span><span class="token string">&quot;Error: Mailbox read failed [Error code %d]\n&quot;</span><span class="token punctuation">,</span> retVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>retVal <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">/* We are done: There are no messages available from the peer execution domain. */</span>
            <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
        <span class="token punctuation">{</span>
            <span class="token comment">/* Flush out the contents of the mailbox to indicate that we are done with the message. This will
             * allow us to receive another message in the mailbox while we process the received message. */</span>
            
            <span class="token comment">/* &#x5237;&#x65B0;&#x90AE;&#x7BB1;&#x51C6;&#x5907;&#x540E;&#x7EED;&#x63A5;&#x6536; */</span>
            <span class="token function">Mailbox_readFlush</span> <span class="token punctuation">(</span>gMmwMssMCB<span class="token punctuation">.</span>peerMailbox<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/* Process the received message: */</span>
            <span class="token comment">/* &#x67E5;&#x770B;&#x6D88;&#x606F;&#x7C7B;&#x578B; */</span> 
            <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">/* &#x5982;&#x679C;&#x7C7B;&#x578B;&#x662F; &quot;MMWDEMO_DSS2MSS_DETOBJ_READY&quot; */</span>
                <span class="token keyword keyword-case">case</span> MMWDEMO_DSS2MSS_DETOBJ_READY<span class="token operator">:</span>
                    <span class="token comment">/* Got detetced objectes , shipped out through UART */</span>

                    <span class="token comment">/* &#x628A;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x4E2D;&#x7684;&#x5927;&#x5C0F;&#x4FE1;&#x606F;&#x63D0;&#x53D6;&#x51FA;&#x6765;,&#x63D0;&#x53D6;&#x5230;&#x4E0B;&#x9762;&#x8FD9;&#x4E2A;&#x53D8;&#x91CF;&#x4E2D; */</span>
                	gMmwMssMCB<span class="token punctuation">.</span>mssDataPathObj<span class="token punctuation">.</span>inputInfoBuffSize <span class="token operator">=</span> message<span class="token punctuation">.</span>body<span class="token punctuation">.</span>detObj<span class="token punctuation">.</span>detObjOutsize<span class="token punctuation">;</span>

                    <span class="token comment">/* &#x5230;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x4E2D;&#x5730;&#x5740;&#x5C06;&#x68C0;&#x6D4B;&#x7684;dsp&#x5904;&#x7406;&#x597D;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&quot;gMmwMssMCB.mssDataPathObj.inputInfo&quot;&#x4E2D;*/</span>
					<span class="token function">memcpy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>gMmwMssMCB<span class="token punctuation">.</span>mssDataPathObj<span class="token punctuation">.</span>inputInfo<span class="token punctuation">)</span><span class="token punctuation">,</span>
                			<span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">SOC_translateAddress</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>body<span class="token punctuation">.</span>detObj<span class="token punctuation">.</span>detObjOutAddress<span class="token punctuation">,</span> SOC_TranslateAddr_Dir_FROM_OTHER_CPU<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
							message<span class="token punctuation">.</span>body<span class="token punctuation">.</span>detObj<span class="token punctuation">.</span>detObjOutsize<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    <span class="token comment">/* &#x8BB0;&#x5F55;&#x65F6;&#x95F4;&#x6233; */</span>
                	timeStart <span class="token operator">=</span> <span class="token function">Cycleprofiler_getTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                	<span class="token comment">/* &#x5F53;&#x524D;&#x65F6;&#x95F4;&#x82B1;&#x8D39;&#x5728;&#x5C06;&#x5904;&#x7406;&#x7ED3;&#x679C;&#x4ECE; DSP &#x4E2D;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x590D;&#x5236;&#x5230;&#x4E3B;&#x673A;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x65F6;&#x95F4;, &#x8FD9;&#x91CC;&#x6709;&#x70B9;&#x7591;&#x95EE;, &#x4E3A;&#x4EC0;&#x4E48;&#x76F4;&#x63A5;&#x8BBE;&#x7F6E;1&#x548C;2 */</span>
                    gMmwMssMCB<span class="token punctuation">.</span>mssDataPathObj<span class="token punctuation">.</span>cycleLog<span class="token punctuation">.</span>copyResultsTimeCurrInusec <span class="token operator">=</span> <span class="token number">1.f</span><span class="token punctuation">;</span>
                    <span class="token comment">/* uart&#x53D1;&#x9001;&#x6570;&#x636E; */</span>
                	<span class="token function">MmwDemo_transmitProcessedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                	gMmwMssMCB<span class="token punctuation">.</span>mssDataPathObj<span class="token punctuation">.</span>cycleLog<span class="token punctuation">.</span>copyResultsTimeCurrInusec <span class="token operator">=</span> <span class="token number">2.f</span><span class="token punctuation">;</span>
                	<span class="token comment">/* &#x8BA1;&#x7B97;&#x53D1;&#x9001;&#x65F6;&#x95F4; */</span>
                    gMmwMssMCB<span class="token punctuation">.</span>mssDataPathObj<span class="token punctuation">.</span>cycleLog<span class="token punctuation">.</span>sendingToUARTTimeCurrInusec <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">Cycleprofiler_getTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>  timeStart<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>R4F_CLOCK_MHZ<span class="token punctuation">)</span><span class="token punctuation">;</span>


                    <span class="token comment">/* Send a message to MSS to log the output data */</span>
                    <span class="token comment">/* &#x6E05;&#x7A7A;message&#x4E2D;&#x7684;&#x6570;&#x636E;&#x4E3A;&#x540E;&#x7EED;&#x91CD;&#x65B0;&#x63A5;&#x6536;&#x505A;&#x51C6;&#x5907; */</span>
                    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>message<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">/* &#x5C06;&#x6D88;&#x606F;&#x8BBE;&#x7F6E;&#x4E3A;&quot;MMWDEMO_MSS2DSS_DETOBJ_SHIPPED&quot;&#x4E3A;&#x522B;&#x7684;&#x64CD;&#x4F5C;&#x505A;&#x51C6;&#x5907; */</span>
                    message<span class="token punctuation">.</span>type <span class="token operator">=</span> MMWDEMO_MSS2DSS_DETOBJ_SHIPPED<span class="token punctuation">;</span>

                    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token function">MmwDemo_mboxWrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>message<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token function">System_printf</span> <span class="token punctuation">(</span><span class="token string">&quot;Error: Mailbox send message id=%d failed \n&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-default">default</span><span class="token operator">:</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">/* Message not support */</span>
                    <span class="token function">System_printf</span> <span class="token punctuation">(</span><span class="token string">&quot;Error: unsupport Mailbox message id=%d\n&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="12-uart%E5%8F%91%E9%80%81%E6%95%B0%E6%8D%AE">1.2 UART&#x53D1;&#x9001;&#x6570;&#x636E;</h2>

<p>&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x540E;,&#x5C06;&#x6570;&#x636E;&#x8D4B;&#x503C;&#x7ED9;mss&#x7684;&#x53D8;&#x91CF;&#x7136;&#x540E;&#x8C03;&#x6574;&#x901A;&#x4FE1;&#x683C;&#x5F0F;(&#x6309;&#x7167;<code>TLV</code>&#x7684;&#x683C;&#x5F0F;&#x53D1;&#x9001;). TLV&#x683C;&#x5F0F;ti&#x7684;&#x6587;&#x6863;&#x4E2D;&#x6709;&#x8BF4;&#x660E;.<br>
<a href="https://dev.ti.com/tirex/explore/node?a=VLyFKFf__2.4.0&amp;node=A__AJXx96rI7gxMSeZVEpNFrw__radar_toolbox__1AslXXD__LATEST">TLV format guide</a></p>
<p><img src="https://raw.githubusercontent.com/fly-t/images/main/blog/index-2023-04-27-09-18-39.png" alt></p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token comment">/** @brief Transmits detection data over UART
*
*    The following data is transmitted:
*    1. Header (size = 32bytes), including &quot;Magic word&quot;, (size = 8 bytes)
*       and icluding the number of TLV items
*    TLV Items:
*    2. If detectedObjects flag is set, pbjOut structure containing range,
*       doppler, and X,Y,Z location for detected objects,
*       size = sizeof(objOut_t) * number of detected objects
*    3. If logMagRange flag is set,  rangeProfile,
*       size = number of range bins * sizeof(uint16_t)
*    4. If noiseProfile flag is set,  noiseProfile,
*       size = number of range bins * sizeof(uint16_t)
*    7. If rangeAzimuthHeatMap flag is set, the zero Doppler column of the
*       range cubed matrix, size = number of Rx Azimuth virtual antennas *
*       number of chirps per frame * sizeof(uint32_t)
*    8. If rangeDopplerHeatMap flag is set, the log magnitude range-Doppler matrix,
*       size = number of range bins * number of Doppler bins * sizeof(uint16_t)
*    9. If statsInfo flag is set, the stats information
*   @param[in] uartHandle   UART driver handle
*   @param[in] obj          Pointer data path object MmwDemo_DataPathObj
*/</span>

<span class="token keyword keyword-void">void</span> <span class="token function">MmwDemo_transmitProcessedOutput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">/* &#x521B;&#x5EFA;header&#x53D8;&#x91CF;&#x5B58;&#x50A8;&#x6570;&#x636E;&#x5934;(FrameHeader) */</span>
    MmwDemo_output_message_header header<span class="token punctuation">;</span>
    <span class="token comment">/* TLV&#x7684;&#x7D22;&#x5F15; */</span>
    <span class="token class-name">uint32_t</span> tlvIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token class-name">uint32_t</span> numPaddingBytes<span class="token punctuation">;</span>
    <span class="token comment">/* &#x6570;&#x636E;&#x5305;&#x7684;&#x957F;&#x5EA6;&#x4FE1;&#x606F; */</span>
    <span class="token class-name">uint32_t</span> packetLen<span class="token punctuation">;</span>
    <span class="token comment">/* &#x6570;&#x636E;&#x5BF9;&#x9F50;&#x586B;&#x5145;&#x7684;padding */</span>
    <span class="token class-name">uint8_t</span> padding<span class="token punctuation">[</span>MMWDEMO_OUTPUT_MSG_SEGMENT_LEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">/* &#x7528;&#x6765;&#x5B58;&#x653E;&#x4ECE;mailBox&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5934;&#x5F97;&#x4FE1;&#x606F; */</span>
    MmwDemo_detOutputHdr           <span class="token operator">*</span>ptrDetOutputHdr<span class="token punctuation">;</span>
	<span class="token comment">/* &#x7528;&#x6765;&#x5B58;&#x653E;&#x4ECE;mailBox&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x503C;&#x90E8;&#x5206; */</span>
    <span class="token class-name">radarProcessOutput_t</span> <span class="token operator">*</span> outputData<span class="token punctuation">;</span>
    <span class="token comment">/* &#x8BBE;&#x7F6E;T(ype)L(ength) */</span>
    MmwDemo_output_message_tl   tl<span class="token punctuation">[</span>MMWDEMO_OUTPUT_MSG_MAX<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token comment">/* &#x7528;&#x6765;&#x5B58;&#x653E;fft&#x6570;&#x636E;&#x7684;&#x957F;&#x5EA6; */</span>
    <span class="token class-name">uint32_t</span> fft1D_length<span class="token punctuation">;</span>
    <span class="token comment">/* &#x5B58;&#x6570;&#x636E;&#x5BF9;&#x8C61;&#x4ECE;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#x63D0;&#x53D6;&#x51FA;&#x6765; */</span>
	MmwDemo_MSS_DataPathObj     <span class="token operator">*</span>obj <span class="token operator">=</span> <span class="token operator">&amp;</span>gMmwMssMCB<span class="token punctuation">.</span>mssDataPathObj<span class="token punctuation">;</span>
	<span class="token comment">/* &#x8BE5;&#x53D8;&#x91CF;&#x51B3;&#x5B9A;&#x4EC0;&#x4E48;&#x53D8;&#x91CF;&#x53D1;&#x9001;&#x7ED9;gui */</span>
    MmwDemo_GuiMonSel   guiMonSel <span class="token operator">=</span> gMmwMssMCB<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span>guiMonSel<span class="token punctuation">;</span>
	<span class="token comment">/* &#x62FF;&#x5230;mss&#x7684;uart&#x53E5;&#x67C4; */</span>
    UART_Handle uartHandle <span class="token operator">=</span> gMmwMssMCB<span class="token punctuation">.</span>loggingUartHandle<span class="token punctuation">;</span>

    <span class="token comment">/* &#x5C06;&#x6570;&#x636E;&#x653E;fft&#x5904;&#x7406;&#x7684;header(chirp&#x5904;&#x7406;&#x65F6;&#x95F4;, &#x76EE;&#x6807;&#x6570;&#x636E;, frame&#x5904;&#x7406;&#x65F6;&#x95F4;, chirp&#x5904;&#x7406;&#x65F6;&#x7684;&#x8D1F;&#x8F7D;,frame&#x5904;&#x7406;&#x65F6;&#x7684;&#x8D1F;&#x8F7D; ) */</span>
    ptrDetOutputHdr <span class="token operator">=</span> <span class="token punctuation">(</span>MmwDemo_detOutputHdr <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>obj<span class="token operator">-&gt;</span>inputInfo<span class="token punctuation">.</span>header<span class="token punctuation">;</span>
    <span class="token comment">/* &#x5B58;&#x653E;&#x5904;&#x7406;fft&#x540E;&#x5B58;&#x50A8;&#x7684;&#x76F8;&#x4F4D;&#x53D8;&#x5316;&#x91CF;, &#x6700;&#x5927;&#x7684;range,fft&#x8F93;&#x51FA;&#x7B49;&#x4FE1;&#x606F; */</span>
    outputData      <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">radarProcessOutput_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>obj<span class="token operator">-&gt;</span>inputInfo<span class="token punctuation">.</span>pointCloudBuf<span class="token punctuation">;</span>
    <span class="token comment">/* &#x63D0;&#x53D6;&#x51FA;1Dfft&#x7684;&#x957F;&#x5EA6;&#x4FE1;&#x606F; */</span>
    fft1D_length	<span class="token operator">=</span>	outputData<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">;</span>

    <span class="token comment">/* Clear message header */</span>
    <span class="token comment">/* &#x6E05;&#x7A7A;&#x6570;&#x636E;&#x5934;, &#x91CD;&#x65B0;&#x6784;&#x9020;&#x6570;&#x636E;&#x5934;, &#x6BCF;&#x4E00;&#x5E27;&#x7684;&#x6570;&#x636E;&#x90FD;&#x91CD;&#x65B0;&#x6784;&#x9020;, &#x9632;&#x6B62;&#x51FA;&#x73B0;&#x810F;&#x6570;&#x636E; */</span>
    <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>header<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Header: */</span>
    header<span class="token punctuation">.</span>platform <span class="token operator">=</span> <span class="token number">0xA1642</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>magicWord<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x0102</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>magicWord<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x0304</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>magicWord<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x0506</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>magicWord<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x0708</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>numDetectedObj <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>version <span class="token operator">=</span>    MMWAVE_SDK_VERSION_BUILD <span class="token operator">|</span>   <span class="token comment">//DEBUG_VERSION</span>
                        <span class="token punctuation">(</span>MMWAVE_SDK_VERSION_BUGFIX <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                        <span class="token punctuation">(</span>MMWAVE_SDK_VERSION_MINOR <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                        <span class="token punctuation">(</span>MMWAVE_SDK_VERSION_MAJOR <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    packetLen <span class="token operator">=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_header<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//detectedObjects</span>
    <span class="token punctuation">{</span>
        tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> MMWDEMO_OUTPUT_MSG_DETECTED_POINTS<span class="token punctuation">;</span>
        tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_detectedObj<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">+</span>
                            <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_dataObjDescr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        packetLen <span class="token operator">+=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_tl<span class="token punctuation">)</span> <span class="token operator">+</span> tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        tlvIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//Range FFT input</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>guiMonSel<span class="token punctuation">.</span>logRangeInput<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> MMWDEMO_OUTPUT_MSG_RANGE_PROFILE<span class="token punctuation">;</span>
        tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span> <span class="token operator">*</span> fft1D_length<span class="token punctuation">;</span>
        packetLen <span class="token operator">+=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_tl<span class="token punctuation">)</span> <span class="token operator">+</span> tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        tlvIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//statsInfo</span>
    <span class="token punctuation">{</span>
        tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">=</span> MMWDEMO_OUTPUT_MSG_STATS<span class="token punctuation">;</span>
        tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
        packetLen <span class="token operator">+=</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_tl<span class="token punctuation">)</span> <span class="token operator">+</span> tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        tlvIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    header<span class="token punctuation">.</span>numTLVs <span class="token operator">=</span> tlvIdx<span class="token punctuation">;</span>
    <span class="token comment">/* Round up packet length to multiple of MMWDEMO_OUTPUT_MSG_SEGMENT_LEN */</span>
    header<span class="token punctuation">.</span>totalPacketLen <span class="token operator">=</span> MMWDEMO_OUTPUT_MSG_SEGMENT_LEN <span class="token operator">*</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>packetLen <span class="token operator">+</span> <span class="token punctuation">(</span>MMWDEMO_OUTPUT_MSG_SEGMENT_LEN<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>MMWDEMO_OUTPUT_MSG_SEGMENT_LEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>timeCpuCycles <span class="token operator">=</span>  <span class="token function">Pmu_getCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    header<span class="token punctuation">.</span>frameNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


    <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span>
                       <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>header<span class="token punctuation">,</span>
                       <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    tlvIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">/* Send detected Objects */</span>
    <span class="token punctuation">{</span>
        MmwDemo_output_message_dataObjDescr descr<span class="token punctuation">;</span>
        MmwDemo_detectedObj dummyDetectionOut<span class="token punctuation">;</span> <span class="token comment">//work around the current format</span>
        <span class="token class-name">int32_t</span> tempRange<span class="token punctuation">;</span>

        <span class="token function">memset</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>dummyDetectionOut<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_detectedObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        tempRange                       <span class="token operator">=</span>   <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>outputData<span class="token operator">-&gt;</span>rangeEst <span class="token operator">*</span> <span class="token number">1048576.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        dummyDetectionOut<span class="token punctuation">.</span>dopplerIdx    <span class="token operator">=</span>   <span class="token number">0</span><span class="token punctuation">;</span>
        dummyDetectionOut<span class="token punctuation">.</span>peakVal       <span class="token operator">=</span>   <span class="token number">0</span><span class="token punctuation">;</span>
        dummyDetectionOut<span class="token punctuation">.</span>rangeIdx      <span class="token operator">=</span>   <span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span> tempRange <span class="token operator">&amp;</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span>
        dummyDetectionOut<span class="token punctuation">.</span>x             <span class="token operator">=</span>   tempRange <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">;</span>
        dummyDetectionOut<span class="token punctuation">.</span>y             <span class="token operator">=</span>   <span class="token number">0</span><span class="token punctuation">;</span>
        dummyDetectionOut<span class="token punctuation">.</span>z             <span class="token operator">=</span>   <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span>
                           <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_tl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/* Send objects descriptor */</span>
        descr<span class="token punctuation">.</span>numDetetedObj <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        descr<span class="token punctuation">.</span>xyzQFormat <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>descr<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_dataObjDescr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*Send array of objects */</span>
        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>dummyDetectionOut<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_detectedObj<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tlvIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Send Range FFT input */</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>guiMonSel<span class="token punctuation">.</span>logRangeInput<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span>
                           <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_tl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>outputData<span class="token operator">-&gt;</span>fft1Dinput<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> fft1D_length <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tlvIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Send stats information */</span>
    <span class="token punctuation">{</span>
        MmwDemo_output_message_stats stats<span class="token punctuation">;</span>
        stats<span class="token punctuation">.</span>interChirpProcessingMargin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span> ptrDetOutputHdr<span class="token operator">-&gt;</span>chirpProcessingMarginInUsec<span class="token punctuation">;</span>
        stats<span class="token punctuation">.</span>interFrameProcessingMargin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span> ptrDetOutputHdr<span class="token operator">-&gt;</span>frameProcessingMarginInUsec<span class="token punctuation">;</span>
        stats<span class="token punctuation">.</span>interFrameProcessingTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        stats<span class="token punctuation">.</span>transmitOutputTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span> obj<span class="token operator">-&gt;</span>cycleLog<span class="token punctuation">.</span>sendingToUARTTimeCurrInusec<span class="token punctuation">;</span>
        stats<span class="token punctuation">.</span>activeFrameCPULoad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span> ptrDetOutputHdr<span class="token operator">-&gt;</span>chirpProcessingLoading<span class="token punctuation">;</span>
        stats<span class="token punctuation">.</span>interFrameCPULoad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span> ptrDetOutputHdr<span class="token operator">-&gt;</span>frameProcessingLoading<span class="token punctuation">;</span>

        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span>
                           <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">,</span>
                           <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>MmwDemo_output_message_tl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span>
                           <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>stats<span class="token punctuation">,</span>
                           tl<span class="token punctuation">[</span>tlvIdx<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tlvIdx<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* Send padding bytes */</span>
    numPaddingBytes <span class="token operator">=</span> MMWDEMO_OUTPUT_MSG_SEGMENT_LEN <span class="token operator">-</span> <span class="token punctuation">(</span>packetLen <span class="token operator">&amp;</span> <span class="token punctuation">(</span>MMWDEMO_OUTPUT_MSG_SEGMENT_LEN<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>numPaddingBytes<span class="token operator">&lt;</span>MMWDEMO_OUTPUT_MSG_SEGMENT_LEN<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">UART_writePolling</span> <span class="token punctuation">(</span>uartHandle<span class="token punctuation">,</span>
                            <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token operator">*</span><span class="token punctuation">)</span>padding<span class="token punctuation">,</span>
                            numPaddingBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="2-%E6%B6%B2%E4%BD%8D%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E9%83%A8%E5%88%86">2. &#x6DB2;&#x4F4D;&#x6570;&#x636E;&#x5904;&#x7406;&#x90E8;&#x5206;</h1>

<p>&#x96F7;&#x8FBE;&#x524D;&#x7AEF;&#x63A5;&#x6536;&#x6570;&#x636E;, &#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x5728;dsp&#x4E0A;&#x5904;&#x7406;</p>
<p><strong>&#x5B58;&#x50A8;&#x5728;L2&#x5185;&#x5B58;&#x4E2D;&#x6240;&#x6709;&#x7684;&#x63A7;&#x5236;&#x7ED3;&#x6784;&#x4F53;</strong>, &#x6240;&#x6709;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x662F;&#x57FA;&#x4E8E;&#x8BE5;&#x7ED3;&#x6784;&#x4F53;&#x8FDB;&#x884C;&#x5C55;&#x5F00;&#x7684;</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-struct">struct</span> <span class="token class-name">_RADARDEMO_highAccuRangeProc_handle_</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> twiddle<span class="token punctuation">;</span>                    <span class="token comment">/**&lt; 1DFFT&#x4F7F;&#x7528;&#x7684;&#x626D;&#x66F2;&#x56E0;&#x5B50;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> wnCoarse<span class="token punctuation">;</span>                   <span class="token comment">/**&lt; &#x7C97;&#x7EA7;&#x522B;&#x7684;&#x9891;&#x7387;&#x626D;&#x66F2;&#x56E0;&#x5B50;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> wnFine<span class="token punctuation">;</span>                     <span class="token comment">/**&lt; &#x7EC6;&#x7EA7;&#x522B;&#x7684;&#x9891;&#x7387;&#x626D;&#x66F2;&#x56E0;&#x5B50;&#x3002;*/</span>

    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> inputSig<span class="token punctuation">;</span>                   <span class="token comment">/**&lt; &#x7528;&#x4E8E;&#x7D2F;&#x79EF;&#x5E27;&#x5185;&#x6240;&#x6709;chirp&#x4FE1;&#x53F7;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> demodSig<span class="token punctuation">;</span>                   <span class="token comment">/**&lt; &#x6307;&#x5411;&#x76F8;&#x4F4D;&#x89E3;&#x8C03;&#x4FE1;&#x53F7;&#x7684;&#x6307;&#x9488;&#x3002;*/</span>

    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> scratchPad<span class="token punctuation">;</span>                 <span class="token comment">/**&lt; &#x6A21;&#x5757;&#x7684;&#x7F13;&#x5B58;&#x5185;&#x5B58;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> fft1DOutSig<span class="token punctuation">;</span>                <span class="token comment">/**&lt; &#x6307;&#x5411;1D FFT&#x8F93;&#x51FA;&#x4FE1;&#x53F7;&#x7684;&#x6307;&#x9488;&#x3002;*/</span>

    <span class="token keyword keyword-float">float</span> maxBeatFreq<span class="token punctuation">;</span>                  <span class="token comment">/**&lt; &#x6700;&#x5927;&#x62CD;&#x9891;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> chirpBandwidth<span class="token punctuation">;</span>               <span class="token comment">/**&lt; chirp&#x5E26;&#x5BBD;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> chirpRampTime<span class="token punctuation">;</span>                <span class="token comment">/**&lt; chirp&#x659C;&#x5761;&#x65F6;&#x95F4;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> fc<span class="token punctuation">;</span>                           <span class="token comment">/**&lt; chirp&#x8D77;&#x59CB;&#x9891;&#x7387;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> chirpSlope<span class="token punctuation">;</span>                   <span class="token comment">/**&lt; chirp&#x659C;&#x7387;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> adcStartTimeConst<span class="token punctuation">;</span>            <span class="token comment">/**&lt; ADC&#x542F;&#x52A8;&#x65F6;&#x95F4;&#x5E38;&#x91CF;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> adcSampleRate<span class="token punctuation">;</span>                <span class="token comment">/**&lt; ADC&#x91C7;&#x6837;&#x7387;&#x3002;*/</span>
    <span class="token class-name">int32_t</span> coarseRangeInd<span class="token punctuation">;</span>             <span class="token comment">/**&lt; &#x7C97;&#x7565;&#x9891;&#x7387;&#x4F30;&#x8BA1;&#x7684;&#x7D22;&#x5F15;&#x3002;*/</span>

    <span class="token class-name">uint32_t</span> fft1DSize<span class="token punctuation">;</span>                 <span class="token comment">/**&lt; 1D FFT&#x5927;&#x5C0F;&#x3002;*/</span>
    <span class="token class-name">uint32_t</span> log2fft1DSize<span class="token punctuation">;</span>             <span class="token comment">/**&lt; 1D FFT&#x5927;&#x5C0F;&#x7684;log2&#x503C;&#x3002;*/</span>
    <span class="token class-name">uint32_t</span> nSamplesPerChirp<span class="token punctuation">;</span>          <span class="token comment">/**&lt; &#x6BCF;&#x4E2A;chirp&#x4E2D;&#x7684;&#x91C7;&#x6837;&#x6570;&#x3002;*/</span>
    <span class="token class-name">uint32_t</span> numChirpsPerFrame<span class="token punctuation">;</span>         <span class="token comment">/**&lt; &#x6BCF;&#x5E27;&#x4E2D;&#x7684;chirp&#x6570;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span> <span class="token operator">*</span> win1D<span class="token punctuation">;</span>                      <span class="token comment">/**&lt; &#x6307;&#x5411;1D&#x7A97;&#x51FD;&#x6570;&#x7684;&#x6307;&#x9488;&#x3002;*/</span>
    <span class="token class-name">int16_t</span> win1DLength<span class="token punctuation">;</span>                <span class="token comment">/**&lt; 1D&#x7A97;&#x51FD;&#x6570;&#x7684;&#x4E00;&#x534A;&#x957F;&#x5EA6;&#x3002;*/</span>

    <span class="token class-name">uint8_t</span> numRangeBinZoomIn<span class="token punctuation">;</span>          <span class="token comment">/**&lt; &#x7528;&#x4E8E;&#x9891;&#x7387;&#x4F30;&#x8BA1;&#x7F29;&#x5C0F;&#x8303;&#x56F4;&#x7684;bin&#x6570;&#x3002;*/</span>
    <span class="token class-name">uint8_t</span> enablePhaseEst<span class="token punctuation">;</span>             <span class="token comment">/**&lt; &#x542F;&#x7528;&#x76F8;&#x4F4D;&#x6821;&#x6B63;&#x8FDB;&#x884C;&#x4F30;&#x8BA1;&#x3002;*/</span>
    <span class="token class-name">uint8_t</span> enableLinearFit<span class="token punctuation">;</span>            <span class="token comment">/**&lt; &#x5728;&#x76F8;&#x4F4D;&#x4F30;&#x8BA1;&#x4E2D;&#x542F;&#x7528;&#x7EBF;&#x6027;&#x62DF;&#x5408;&#x3002;*/</span>
    <span class="token class-name">uint8_t</span> enableFilter<span class="token punctuation">;</span>               <span class="token comment">/**&lt; &#x5728;&#x76F8;&#x4F4D;&#x4F30;&#x8BA1;&#x4E2D;&#x542F;&#x7528;&#x6EE4;&#x6CE2;&#x3002;*/</span>
    <span class="token class-name">uint16_t</span> skipLeft<span class="token punctuation">;</span>                  <span class="token comment">/**&lt; &#x4ECE;&#x5DE6;&#x4FA7;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570;&#x3002;*/</span>
    <span class="token class-name">uint16_t</span> skipRight<span class="token punctuation">;</span>                 <span class="token comment">/**&lt; &#x4ECE;&#x53F3;&#x4FA7;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570;&#x3002;*/</span>
    <span class="token keyword keyword-float">float</span>      skipMin<span class="token punctuation">;</span>                 <span class="token comment">/* &#x4ECE;0&#x5230;&#x6700;&#x5C0F;&#x8303;&#x56F4;&#xFF08;m&#xFF09;&#x8981;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570; */</span>   
    <span class="token keyword keyword-float">float</span>      skipMax<span class="token punctuation">;</span>                 <span class="token comment">/* &#x4ECE;&#x6700;&#x5927;&#x8303;&#x56F4;&#xFF08;m&#xFF09;&#x5230;&#x8FDC;&#x5904;&#x8981;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570; */</span>

<span class="token punctuation">}</span> RADARDEMO_highAccuRangeProc_handle<span class="token punctuation">;</span>
</pre><p><strong>&#x96F7;&#x8FBE;&#x914D;&#x7F6E;&#x914D;&#x7F6E;&#x7ED3;&#x6784;&#x4F53;</strong>, &#x96F7;&#x8FBE;&#x6240;&#x6709;&#x7684;&#x76F8;&#x5173;&#x914D;&#x7F6E;&#x90FD;&#x5728;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;, &#x4E3B;&#x8981;&#x7684;&#x5904;&#x7406;&#x64CD;&#x4F5C;&#x662F;&#x5C06;&#x8BE5;&#x914D;&#x7F6E;&#x7ED3;&#x6784;&#x4F53;&#x4F20;&#x9012;&#x5230;&#x4E0A;&#x9762;&#x7684;&#x63A7;&#x5236;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;. &#x7136;&#x540E;&#x8FDB;&#x884C;&#x76F8;&#x5173;&#x64CD;&#x4F5C;. &#x8FD9;&#x5927;&#x5927;&#x964D;&#x4F4E;&#x4E86;&#x4EE3;&#x7801;&#x7684;&#x8026;&#x5408;&#x6027;.</p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-typedef">typedef</span> <span class="token keyword keyword-struct">struct</span> <span class="token class-name">_RADARDEMO_highAccuRangeProc_config_</span>
<span class="token punctuation">{</span>
	<span class="token class-name">uint32_t</span>     fft1DSize<span class="token punctuation">;</span>  					<span class="token comment">/**&lt; 1D FFT size&#xFF0C;                                      &#x4E00;&#x7EF4;FFT&#x7684;&#x5927;&#x5C0F;*/</span>
	<span class="token class-name">uint32_t</span>     nSamplesPerChirp<span class="token punctuation">;</span>				<span class="token comment">/**&lt; number of samples per chirp&#xFF0C;                      &#x6BCF;&#x4E2A;chirp&#x4E2D;&#x7684;&#x91C7;&#x6837;&#x70B9;&#x6570;*/</span>
	<span class="token class-name">uint32_t</span>     numChirpsPerFrame<span class="token punctuation">;</span>				<span class="token comment">/**&lt; number of chirp per frame&#xFF0C;                        &#x6BCF;&#x5E27;&#x4E2D;&#x7684;chirp&#x6570;&#x91CF;*/</span>
	<span class="token keyword keyword-float">float</span>        maxBeatFreq<span class="token punctuation">;</span>  	    			<span class="token comment">/**&lt; maximum beat frequency&#xFF0C;                           &#x6700;&#x5927;&#x62CD;&#x9891;*/</span>
	<span class="token keyword keyword-float">float</span>        chirpBandwidth<span class="token punctuation">;</span>  	    		<span class="token comment">/**&lt; chirp bandwidth&#xFF0C;                                  chirp&#x5E26;&#x5BBD;*/</span>
	<span class="token keyword keyword-float">float</span>        chirpRampTime<span class="token punctuation">;</span>  	    		<span class="token comment">/**&lt; chirp ramp duration&#xFF0C;                              chirp&#x7684;&#x659C;&#x53D8;&#x65F6;&#x95F4;*/</span>
	<span class="token keyword keyword-float">float</span>        fc<span class="token punctuation">;</span>  	    					<span class="token comment">/**&lt; chirp start frequency&#xFF0C;                            chirp&#x7684;&#x8D77;&#x59CB;&#x9891;&#x7387;*/</span>
	<span class="token keyword keyword-float">float</span>        chirpSlope<span class="token punctuation">;</span>  	    			<span class="token comment">/**&lt; chirp slope&#xFF0C;                                      chirp&#x7684;&#x659C;&#x7387;*/</span>
	<span class="token keyword keyword-float">float</span>        adcStartTimeConst<span class="token punctuation">;</span>  	    	<span class="token comment">/**&lt; ADC start constant&#xFF0C;                               ADC&#x542F;&#x52A8;&#x5E38;&#x6570;*/</span>
	<span class="token keyword keyword-float">float</span>        adcSampleRate<span class="token punctuation">;</span>  	    		<span class="token comment">/**&lt; ADC sampling rate&#xFF0C;                                ADC&#x91C7;&#x6837;&#x7387;*/</span>
	<span class="token keyword keyword-float">float</span>       <span class="token operator">*</span>win1D<span class="token punctuation">;</span>  	    	            <span class="token comment">/**&lt; pointer to 1D windowing function&#xFF0C;                 &#x6307;&#x5411;&#x4E00;&#x7EF4;&#x7A97;&#x51FD;&#x6570;&#x7684;&#x6307;&#x9488;*/</span>
	<span class="token class-name">int16_t</span>      win1DLength<span class="token punctuation">;</span>  	    	        <span class="token comment">/**&lt; half length of the 1D windowing function&#xFF0C;         &#x4E00;&#x7EF4;&#x7A97;&#x51FD;&#x6570;&#x7684;&#x4E00;&#x534A;&#x957F;&#x5EA6;*/</span>
	<span class="token class-name">uint8_t</span>      numRangeBinZoomIn<span class="token punctuation">;</span>  	        <span class="token comment">/**&lt; number of bins to zoom in for frequenc estimation&#xFF0C;&#x8FDB;&#x884C;&#x9891;&#x7387;&#x4F30;&#x8BA1;&#x7684;&#x7F29;&#x653E;&#x7684;&#x8303;&#x56F4;*/</span>
	<span class="token class-name">uint8_t</span>      enablePhaseEst<span class="token punctuation">;</span>  				<span class="token comment">/**&lt; enable estimation using phase correction&#xFF0C;         &#x4F7F;&#x7528;&#x76F8;&#x4F4D;&#x6821;&#x6B63;&#x8FDB;&#x884C;&#x4F30;&#x8BA1;&#x7684;&#x5F00;&#x5173;*/</span>
	<span class="token class-name">uint8_t</span>      enableLinearFit<span class="token punctuation">;</span>  				<span class="token comment">/**&lt; enable linear fit in phase estimation&#xFF0C;            &#x5728;&#x76F8;&#x4F4D;&#x4F30;&#x8BA1;&#x4E2D;&#x5F00;&#x542F;&#x7EBF;&#x6027;&#x62DF;&#x5408;*/</span>
	<span class="token class-name">uint8_t</span>      enableFilter<span class="token punctuation">;</span>  				<span class="token comment">/**&lt; enable filtering in phase estimation&#xFF0C;             &#x5728;&#x76F8;&#x4F4D;&#x4F30;&#x8BA1;&#x4E2D;&#x5F00;&#x542F;&#x6EE4;&#x6CE2;*/</span>
	<span class="token class-name">uint16_t</span>     skipLeft<span class="token punctuation">;</span>						<span class="token comment">/**&lt; number of samples to skip from the left&#xFF0C;          &#x4ECE;&#x5DE6;&#x4FA7;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570;*/</span>
	<span class="token class-name">uint16_t</span>     skipRight<span class="token punctuation">;</span>					    <span class="token comment">/**&lt; number of samples to skip from the right&#xFF0C;         &#x4ECE;&#x53F3;&#x4FA7;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570;*/</span>
	<span class="token keyword keyword-float">float</span>       <span class="token operator">*</span>fft1DIn<span class="token punctuation">;</span>  	    	            <span class="token comment">/**&lt; pointer to 1D FFT input&#xFF0C;                          &#x6307;&#x5411;&#x4E00;&#x7EF4;FFT&#x8F93;&#x5165;&#x7684;&#x6307;&#x9488;*/</span>
    <span class="token class-name">uint8_t</span>      enableRangeLimit<span class="token punctuation">;</span>              <span class="token comment">/**&lt; enable RangeLimit&#xFF0C;                                &#x5F00;&#x542F;&#x8303;&#x56F4;&#x9650;&#x5236;*/</span>
    <span class="token keyword keyword-float">float</span>        skipMin<span class="token punctuation">;</span>                       <span class="token comment">/**&lt; number of samples to skip from 0 to min range(m)&#xFF0C; &#x4ECE;0&#x5230;&#x6700;&#x5C0F;&#x8303;&#x56F4;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570;&#xFF08;&#x7C73;&#xFF09;*/</span>
    <span class="token keyword keyword-float">float</span>        skipMax<span class="token punctuation">;</span>                       <span class="token comment">/**&lt; number of samples to skip from the max range(m) to faraway&#xFF0C;&#x4ECE;&#x6700;&#x5927;&#x8303;&#x56F4;&#xFF08;&#x7C73;&#xFF09;&#x5230;&#x8FDC;&#x5904;&#x8DF3;&#x8FC7;&#x7684;&#x6837;&#x672C;&#x6570;*/</span>

<span class="token punctuation">}</span> RADARDEMO_highAccuRangeProc_config<span class="token punctuation">;</span>
</pre><h2 class="mume-header" id="21-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96-%E6%B6%B2%E4%BD%8D%E9%AB%98%E5%BA%A6demo">2.1 &#x521B;&#x5EFA;&#x548C;&#x521D;&#x59CB;&#x5316; &#x6DB2;&#x4F4D;&#x9AD8;&#x5EA6;Demo</h2>

<p>&#x8C03;&#x5236;&#x659C;&#x7387;&#x4E3A;handle-&gt;chirpSlope&#x3001;1D FFT&#x5C3A;&#x5BF8;&#x4E3A;handle-&gt;fft1DSize&#x65F6;&#x7684;&#x8DDD;&#x79BB;&#x5206;&#x8FA8;&#x7387;&#x3002;&#x8DDD;&#x79BB;&#x5206;&#x8FA8;&#x7387;&#x662F;&#x96F7;&#x8FBE;&#x6D4B;&#x8DDD;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x8868;&#x793A;&#x80FD;&#x591F;&#x5206;&#x8FA8;&#x51FA;&#x4E24;&#x4E2A;&#x7269;&#x4F53;&#x4E4B;&#x95F4;&#x7684;&#x6700;&#x5C0F;&#x8DDD;&#x79BB;&#x3002;</p>
<p>&#x8DDD;&#x79BB;&#x5206;&#x8FA8;&#x7387;&#x516C;&#x5F0F;</p>
<p><img src="https://raw.githubusercontent.com/fly-t/images/main/blog/index-2023-04-27-13-22-28.png" alt></p>
<p>&#x5176;&#x4E2D;&#xFF0C;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">&#x394;</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">\Delta r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">&#x394;</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>&#x4E3A;&#x8DDD;&#x79BB;&#x5206;&#x8FA8;&#x7387;&#xFF0C;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>&#x4E3A;&#x5149;&#x901F;&#xFF0C;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>&#x4E3A;&#x8C03;&#x5236;&#x5E26;&#x5BBD;&#xFF0C;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>&#x4E3A;FFT&#x70B9;&#x6570;&#x3002;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5C06;&#x5149;&#x901F;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span>&#x548C;&#x8C03;&#x5236;&#x5E26;&#x5BBD;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span>&#x7528;&#x5E38;&#x6570;<code>3.0e8</code>&#x548C;<code>handle-&gt;adcSampleRate</code>&#x8868;&#x793A;&#xFF0C;FFT&#x70B9;&#x6570;<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>&#x7528;handle-&gt;fft1DSize&#x8868;&#x793A;&#x3002;&#x5C06;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x4EE3;&#x5165;&#x8DDD;&#x79BB;&#x5206;&#x8FA8;&#x7387;&#x516C;&#x5F0F;&#x8BA1;&#x7B97;&#x5373;&#x53EF;.</p>
<p>src: <code>RADARDEMO_highAccuRangeProc.c</code></p>
<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token keyword keyword-void">void</span>	<span class="token operator">*</span> <span class="token function">RADARDEMO_highAccuRangeProc_create</span><span class="token punctuation">(</span>
                            IN  RADARDEMO_highAccuRangeProc_config <span class="token operator">*</span> moduleConfig<span class="token punctuation">,</span> 
							OUT RADARDEMO_highAccuRangeProc_errorCode <span class="token operator">*</span> errorCode<span class="token punctuation">)</span>
							
<span class="token punctuation">{</span>
	<span class="token class-name">int32_t</span>     i<span class="token punctuation">,</span> itemp<span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span>		real<span class="token punctuation">,</span> imag<span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span> PI <span class="token operator">=</span> <span class="token number">3.14159265358979323846</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-double">double</span>		denom<span class="token punctuation">;</span>
    <span class="token class-name">uint8_t</span> enableRangeLimit<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> skipMin<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> skipMax<span class="token punctuation">;</span>
    <span class="token keyword keyword-float">float</span> rangeResolution<span class="token punctuation">;</span>

	RADARDEMO_highAccuRangeProc_handle <span class="token operator">*</span> handle<span class="token punctuation">;</span>
	
	<span class="token operator">*</span>errorCode		<span class="token operator">=</span>	RADARDEMO_HIGHACCURANGEPROC_NO_ERROR<span class="token punctuation">;</span>

	handle						<span class="token operator">=</span>	<span class="token punctuation">(</span>RADARDEMO_highAccuRangeProc_handle <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>RADARDEMO_highAccuRangeProc_handle<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>handle <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">*</span>errorCode	<span class="token operator">=</span>	RADARDEMO_HIGHACCURANGEPROC_FAIL_ALLOCATE_HANDLE<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	handle<span class="token operator">-&gt;</span>nSamplesPerChirp	<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>nSamplesPerChirp<span class="token punctuation">;</span><span class="token comment">//512</span>
	handle<span class="token operator">-&gt;</span>fft1DSize			<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">;</span><span class="token comment">//512</span>
	handle<span class="token operator">-&gt;</span>numChirpsPerFrame	<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>numChirpsPerFrame<span class="token punctuation">;</span><span class="token comment">//200</span>
	handle<span class="token operator">-&gt;</span>win1DLength			<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>win1DLength<span class="token punctuation">;</span><span class="token comment">//16</span>
	handle<span class="token operator">-&gt;</span>maxBeatFreq			<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>maxBeatFreq<span class="token punctuation">;</span><span class="token comment">//5000k</span>
	handle<span class="token operator">-&gt;</span>chirpBandwidth		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>chirpBandwidth<span class="token punctuation">;</span><span class="token comment">//3450805504Hz</span>
	handle<span class="token operator">-&gt;</span>chirpRampTime		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>chirpRampTime<span class="token punctuation">;</span><span class="token comment">//102.4us</span>
	handle<span class="token operator">-&gt;</span>fc					<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>fc<span class="token punctuation">;</span><span class="token comment">//77GHz</span>
	handle<span class="token operator">-&gt;</span>chirpSlope			<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>chirpSlope<span class="token punctuation">;</span><span class="token comment">//33.699MHz/us</span>
	handle<span class="token operator">-&gt;</span>adcStartTimeConst	<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>adcStartTimeConst<span class="token punctuation">;</span><span class="token comment">//0</span>
	handle<span class="token operator">-&gt;</span>adcSampleRate		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>adcSampleRate<span class="token punctuation">;</span><span class="token comment">//500K</span>
	handle<span class="token operator">-&gt;</span>numRangeBinZoomIn	<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>numRangeBinZoomIn<span class="token punctuation">;</span><span class="token comment">//2</span>
	handle<span class="token operator">-&gt;</span>enablePhaseEst		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>enablePhaseEst<span class="token punctuation">;</span><span class="token comment">//0</span>
	handle<span class="token operator">-&gt;</span>enableLinearFit		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>enableLinearFit<span class="token punctuation">;</span><span class="token comment">//0</span>
	handle<span class="token operator">-&gt;</span>enableFilter		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>enableFilter<span class="token punctuation">;</span><span class="token comment">//0</span>
	handle<span class="token operator">-&gt;</span>skipLeft			<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>skipLeft<span class="token punctuation">;</span><span class="token comment">//0</span>
	handle<span class="token operator">-&gt;</span>skipRight			<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>skipRight<span class="token punctuation">;</span><span class="token comment">//0</span>
    enableRangeLimit            <span class="token operator">=</span>   moduleConfig<span class="token operator">-&gt;</span>enableRangeLimit<span class="token punctuation">;</span><span class="token comment">//0</span>
    skipMin                     <span class="token operator">=</span>   moduleConfig<span class="token operator">-&gt;</span>skipMin<span class="token punctuation">;</span><span class="token comment">//0.26</span>
    skipMax                     <span class="token operator">=</span>   moduleConfig<span class="token operator">-&gt;</span>skipMax<span class="token punctuation">;</span><span class="token comment">//6.00</span>
	itemp						<span class="token operator">=</span>	handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">;</span>
	i							<span class="token operator">=</span>	<span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">/* &#x8BA1;&#x7B97;&#x8DDD;&#x79BB;&#x5206;&#x8FA8;&#x7387; */</span>
	rangeResolution <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3.0</span><span class="token operator">*</span><span class="token number">1e8</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>handle<span class="token operator">-&gt;</span>adcSampleRate<span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>handle<span class="token operator">-&gt;</span>chirpSlope <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span>handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0.043468</span>

<span class="token comment">//    printf(&quot;DSS:win1DLength=%d\n&quot;,handle-&gt;fft1DSize);</span>
<span class="token comment">//    printf(&quot;DSS:digOutSampleRate=%f\n&quot;,handle-&gt;adcSampleRate);</span>
<span class="token comment">//    printf(&quot;DSS:freqSlopeConst=%f\n&quot;,handle-&gt;chirpSlope);</span>
<span class="token comment">//    printf(&quot;DSS:rangeResolution=%f\n&quot;,rangeResolution);</span>

    <span class="token class-name">uint16_t</span> RangeBinfft1DSize<span class="token punctuation">,</span>RangeBinMin<span class="token punctuation">,</span>RangeBinMax<span class="token punctuation">;</span>

    <span class="token comment">/* &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x8DDD;&#x79BB;&#x9650;&#x5236;&#x503C; */</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>enableRangeLimit<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/* fft&#x5927;&#x5C0F;:512, &#x8FD9;&#x91CC;&#x6839;&#x636E;&#x9650;&#x5236;&#x7684;&#x8DDD;&#x79BB;&#x8303;&#x56F4;&#x8FDB;&#x4E00;&#x6B65;&#x9650;&#x5236;&#x5904;&#x7406;&#x6570;&#x636E;, &#x63D0;&#x9AD8;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x6548;&#x7387; */</span>
        RangeBinfft1DSize           <span class="token operator">=</span>   handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">;</span>
        <span class="token comment">/* &#x5BF9;&#x8BA1;&#x7B97;&#x51FA;&#x7684;rangebin&#x8FDB;&#x884C;&#x56DB;&#x820D;&#x4E94;&#x5165; */</span>
        RangeBinMin                 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>skipMin<span class="token operator">/</span>rangeResolution <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        RangeBinMax                 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>skipMax<span class="token operator">/</span>rangeResolution <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* &#x5982;&#x679C;rangebin&#x4E0B;&#x6EA2;&#x5C31;&#x8BBE;&#x7F6E;&#x4E3A;0 */</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>RangeBinMin <span class="token operator">&gt;</span> RangeBinfft1DSize<span class="token punctuation">)</span>
            RangeBinMin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">/* &#x5982;&#x679C;rangebin&#x4E0A;&#x6EA2;&#x5C31;&#x8BBE;&#x7F6E;&#x4E3A;rangebin&#x6700;&#x5927;&#x503C; */</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>RangeBinMax <span class="token operator">&gt;</span> RangeBinfft1DSize<span class="token punctuation">)</span>
            RangeBinMax <span class="token operator">=</span> RangeBinfft1DSize<span class="token punctuation">;</span>

        <span class="token comment">/* &#x9650;&#x5236;&#x7684;rangeBin&#x5DE6;&#x53F3;&#x533A;&#x95F4; */</span>
        handle<span class="token operator">-&gt;</span>skipLeft            <span class="token operator">=</span>   RangeBinMin<span class="token punctuation">;</span><span class="token comment">//6</span>
        handle<span class="token operator">-&gt;</span>skipRight           <span class="token operator">=</span>   RangeBinfft1DSize <span class="token operator">-</span> RangeBinMax<span class="token punctuation">;</span><span class="token comment">//374</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;DSS:enableRangeLimit=%d,skipMin=%.2f,skipMax=%.2f,rangeResolution=%.4f,skipLeft=%d,skipRight=%d\n&quot;</span><span class="token punctuation">,</span>enableRangeLimit<span class="token punctuation">,</span>skipMin<span class="token punctuation">,</span>skipMax<span class="token punctuation">,</span>rangeResolution<span class="token punctuation">,</span>handle<span class="token operator">-&gt;</span>skipLeft<span class="token punctuation">,</span>handle<span class="token operator">-&gt;</span>skipRight<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;DSS:enableRangeLimit=%d\n&quot;</span><span class="token punctuation">,</span>enableRangeLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token comment">/* &#x540C;&#x4EF7;itemp&#x5728;&#x4E8C;&#x8FDB;&#x5236;&#x683C;&#x5F0F;&#x4E0B;&#x6709;&#x591A;&#x5C11;&#x4E2A;1, &#x7136;&#x540E;&#x5B58;&#x50A8;&#x5728;i&#x53D8;&#x91CF;&#x4E2D; */</span>
	<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>itemp <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        itemp <span class="token operator">=</span> itemp <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* fft&#x7EA7;&#x8054;&#x6B21;&#x6570;log2(64)=6 */</span>
	handle<span class="token operator">-&gt;</span>log2fft1DSize		<span class="token operator">=</span>	i<span class="token punctuation">;</span>

    <span class="token comment">/* &#x5728;L2&#x5185;&#x5B58;&#x4E2D;&#x7533;&#x8BF7;&#x4E00;&#x5757;`&#x7A97;`&#x53E5;&#x67C4;&#x7A7A;&#x95F4; */</span>
	handle<span class="token operator">-&gt;</span>win1D				<span class="token operator">=</span>	<span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> moduleConfig<span class="token operator">-&gt;</span>win1DLength <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">/* &#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7801; */</span>
	<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>handle<span class="token operator">-&gt;</span>win1D <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">*</span>errorCode	<span class="token operator">=</span>	RADARDEMO_HIGHACCURANGEPROC_FAIL_ALLOCATE_LOCALINSTMEM<span class="token punctuation">;</span>
		<span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">/* &#x62FF;&#x5230;dss_data_path&#x4E2D;&#x7684;&#x7A97;&#x53C2;&#x6570; */</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span>moduleConfig<span class="token operator">-&gt;</span>win1DLength<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		handle<span class="token operator">-&gt;</span>win1D<span class="token punctuation">[</span>i<span class="token punctuation">]</span>		<span class="token operator">=</span>	moduleConfig<span class="token operator">-&gt;</span>win1D<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    
    <span class="token comment">/* &#x9996;&#x5148;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x4E3A;handle-&gt;twiddle(&#x65CB;&#x8F6C;&#x56E0;&#x5B50;, &#x4E3A;fft&#x505A;&#x51C6;&#x5907;)&#x5206;&#x914D;&#x4E00;&#x5757;&#x7A7A;&#x95F4;&#xFF0C;&#x5927;&#x5C0F;&#x4E3A;2 * handle-&gt;fft1DSize *sizeof(float) */</span>
	handle<span class="token operator">-&gt;</span>twiddle			<span class="token operator">=</span>	<span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> handle<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/* &#x5224;&#x65AD;&#x5E76;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7801; */</span>

    
    <span class="token comment">/* &#x8C03;&#x7528;tw_gen_float&#x51FD;&#x6570;&#x751F;&#x6210;1D FFT&#x6240;&#x9700;&#x7684;&#x65CB;&#x8F6C;&#x56E0;&#x5B50;&#xFF0C;&#x5B58;&#x50A8;&#x5728;handle-&gt;twiddle&#x4E2D;,&#x65CB;&#x8F6C;&#x56E0;&#x5B50;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x5085;&#x91CC;&#x53F6;&#x53D8;&#x6362;&#xFF08;FFT&#xFF09;&#x7B97;&#x6CD5;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x5FEB;&#x901F;&#x5730;&#x5C06;&#x65F6;&#x57DF;&#x91C7;&#x6837;&#x8F6C;&#x6362;&#x4E3A;&#x9891;&#x57DF;&#x4FE1;&#x53F7; */</span>
	<span class="token function">tw_gen_float</span><span class="token punctuation">(</span>handle<span class="token operator">-&gt;</span>twiddle<span class="token punctuation">,</span> handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* &#x4E3A;&#x5373;&#x5C06;&#x505A;fft&#x7684;&#x8F93;&#x5165;&#x4FE1;&#x53F7;(&#x6570;&#x636E;)&#x7533;&#x8BF7;&#x7A7A;&#x95F4; */</span>
	handle<span class="token operator">-&gt;</span>inputSig		<span class="token operator">=</span>	<span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> handle<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* &#x5224;&#x65AD;&#x5E76;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7801; */</span>
	

    <span class="token comment">/* &#x5728;L2&#x4E2D;&#x7533;&#x8BF7;&#x5185;&#x5B58;, &#x7528;&#x4F5C;&#x5085;&#x91CC;&#x53F6;&#x53D8;&#x6362;&#x8FD0;&#x7B97;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x4E2D;&#x95F4;&#x8BA1;&#x7B97;&#x7ED3;&#x679C; */</span>
	handle<span class="token operator">-&gt;</span>scratchPad		<span class="token operator">=</span>	<span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> handle<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* &#x5224;&#x65AD;&#x5E76;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x7801; */</span>

    <span class="token comment">/* `FFT1D&#x8F93;&#x51FA;&#x7ED3;&#x679C;` &#x548C; `&#x76F8;&#x4F4D;&#x89E3;&#x8C03;`&#x7684;&#x7ED3;&#x679C;&#x90FD;&#x5B58;&#x653E;&#x5728;&#x7F13;&#x51B2;scratchPad&#x53D8;&#x91CF;&#x4E2D; */</span>
	handle<span class="token operator">-&gt;</span>fft1DOutSig		<span class="token operator">=</span>	handle<span class="token operator">-&gt;</span>scratchPad<span class="token punctuation">;</span>
    <span class="token comment">/* &#x76F8;&#x4F4D;&#x89E3;&#x8C03;:&#x5C06;&#x8C03;&#x5236;&#x4FE1;&#x53F7;&#x4ECE;&#x590D;&#x6570;&#x57DF;&#x6620;&#x5C04;&#x5230;&#x5B9E;&#x6570;&#x57DF;&#xFF0C;&#x5E76;&#x901A;&#x8FC7;&#x8FD9;&#x79CD;&#x6620;&#x5C04; `&#x53BB;&#x9664;&#x76F8;&#x4F4D;&#x4FE1;&#x606F;`&#x3002;&#x5728;&#x89E3;&#x8C03;&#x4E4B;&#x540E;&#xFF0C;&#x5F97;&#x5230;&#x7684;&#x4FE1;&#x53F7; `&#x53EA;&#x5305;&#x542B;&#x632F;&#x5E45;&#x4FE1;&#x606F;` */</span>
	handle<span class="token operator">-&gt;</span>demodSig		<span class="token operator">=</span>	handle<span class="token operator">-&gt;</span>scratchPad<span class="token punctuation">;</span>
    
    <span class="token comment">/* &#x5C06;&#x6240;&#x6709;&#x7684;fft&#x539F;&#x59CB;&#x6570;&#x636E;&#x653E;&#x5230; `fft1DIn` &#x8FD9;&#x4E2A;&#x6307;&#x9488;&#x53D8;&#x91CF;&#x4E2D;&#x5E26;&#x56DE;&#x53BB; */</span>
	moduleConfig<span class="token operator">-&gt;</span>fft1DIn 	<span class="token operator">=</span> handle<span class="token operator">-&gt;</span>inputSig<span class="token punctuation">;</span>

    <span class="token comment">/* &#x5206;&#x914D;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8; `&#x7C97;` &#x8C03;&#x7684;&#x65CB;&#x8F6C;&#x56E0;&#x5B50;&#xFF08;wnCoarse&#xFF09; */</span>
	handle<span class="token operator">-&gt;</span>wnCoarse		<span class="token operator">=</span>	<span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> handle<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
    <span class="token comment">/* &#x751F;&#x6210;&#x4E00;&#x7EC4;&#x7528;&#x4E8E;&#x5085;&#x91CC;&#x53F6;&#x53D8;&#x6362;&#x7684;`&#x7C97;`&#x8C03;&#x65CB;&#x8F6C;&#x56E0;&#x5B50;, &#x5B58;&#x50A8;&#x5728; `wnCoarse` &#x4E2D; */</span>
	denom <span class="token operator">=</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span>handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span>handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		real		<span class="token operator">=</span>	<span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> i <span class="token operator">*</span>denom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		imag		<span class="token operator">=</span>	<span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> i <span class="token operator">*</span>denom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		handle<span class="token operator">-&gt;</span>wnCoarse<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span>		<span class="token operator">=</span>	imag<span class="token punctuation">;</span>
		handle<span class="token operator">-&gt;</span>wnCoarse<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">]</span>	<span class="token operator">=</span>	real<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token comment">/* &#x5206;&#x914D;&#x4E00;&#x5757;&#x5185;&#x5B58;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x50A8; `&#x7EC6;` &#x8C03;&#x7684;&#x65CB;&#x8F6C;&#x56E0;&#x5B50;&#xFF08;wnCoarse&#xFF09; */</span>
	handle<span class="token operator">-&gt;</span>wnFine		<span class="token operator">=</span>	<span class="token punctuation">(</span><span class="token keyword keyword-float">float</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">radarOsal_memAlloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> RADARMEMOSAL_HEAPTYPE_LL2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> handle<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	

    <span class="token comment">/* &#x7528;&#x4E8E;&#x751F;&#x6210;&#x4E00;&#x7EC4;&#x7528;&#x4E8E;&#x5085;&#x91CC;&#x53F6;&#x53D8;&#x6362;&#x7684;`&#x7EC6;`&#x8C03;&#x65CB;&#x8F6C;&#x56E0;&#x5B50;, &#x5B58;&#x50A8;&#x5728; `wnFine` &#x4E2D; */</span>
	denom <span class="token operator">=</span> <span class="token number">1.0</span><span class="token operator">/</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>handle<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#x5C06;&#x65CB;&#x8F6C;&#x56E0;&#x5B50;&#x9650;&#x5236;&#x5728;&#x5355;&#x4F4D;&#x5706;&#x4E0A;</span>
	<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span>handle<span class="token operator">-&gt;</span>fft1DSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		real		<span class="token operator">=</span>	<span class="token function">cos</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> i <span class="token operator">*</span>denom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		imag		<span class="token operator">=</span>	<span class="token function">sin</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">*</span> i <span class="token operator">*</span>denom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		handle<span class="token operator">-&gt;</span>wnFine<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span>		<span class="token operator">=</span>	imag<span class="token punctuation">;</span>
		handle<span class="token operator">-&gt;</span>wnFine<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">]</span>	<span class="token operator">=</span>	real<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword keyword-return">return</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-void">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h2 class="mume-header" id="22-%E9%87%8A%E6%94%BE%E6%89%80%E5%88%9B%E5%BB%BA%E6%97%B6%E7%94%B3%E8%AF%B7%E7%9A%84%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4">2.2 &#x91CA;&#x653E;&#x6240;&#x521B;&#x5EFA;&#x65F6;&#x7533;&#x8BF7;&#x7684;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</h2>

<pre data-role="codeBlock" data-info="c" class="language-c"><span class="token comment">/* &#x91CA;&#x653E;&#x6240;&#x6709;&#x7533;&#x8BF7;&#x989D;&#x7A7A;&#x95F4; */</span>
<span class="token keyword keyword-void">void</span>	<span class="token function">RADARDEMO_highAccuRangeProc_delete</span><span class="token punctuation">(</span>
                            IN  <span class="token keyword keyword-void">void</span> <span class="token operator">*</span> handle<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	RADARDEMO_highAccuRangeProc_handle <span class="token operator">*</span>rangeProcInst<span class="token punctuation">;</span>
	
	rangeProcInst	<span class="token operator">=</span>	<span class="token punctuation">(</span>RADARDEMO_highAccuRangeProc_handle <span class="token operator">*</span><span class="token punctuation">)</span> handle<span class="token punctuation">;</span>

	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>rangeProcInst<span class="token operator">-&gt;</span>inputSig<span class="token punctuation">,</span> rangeProcInst<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>rangeProcInst<span class="token operator">-&gt;</span>twiddle<span class="token punctuation">,</span> rangeProcInst<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>rangeProcInst<span class="token operator">-&gt;</span>wnFine<span class="token punctuation">,</span> rangeProcInst<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>rangeProcInst<span class="token operator">-&gt;</span>wnCoarse<span class="token punctuation">,</span> rangeProcInst<span class="token operator">-&gt;</span>fft1DSize <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>rangeProcInst<span class="token operator">-&gt;</span>win1D<span class="token punctuation">,</span> rangeProcInst<span class="token operator">-&gt;</span>win1DLength <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>rangeProcInst<span class="token operator">-&gt;</span>demodSig<span class="token punctuation">,</span> rangeProcInst<span class="token operator">-&gt;</span>nSamplesPerChirp <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span><span class="token keyword keyword-float">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">radarOsal_memFree</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>RADARDEMO_highAccuRangeProc_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>